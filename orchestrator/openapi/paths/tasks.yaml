projects-id-tasks:
  get:
    summary: List tasks
    description: Get all tasks for a project
    operationId: listTasks
    tags:
      - Tasks
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Project ID
      - name: status
        in: query
        schema:
          type: string
          enum: [backlog, ready, in_progress, pending_review, approved, done]
        description: Filter by task status
      - name: epic_id
        in: query
        schema:
          type: integer
        description: Filter by epic ID
      - name: page
        in: query
        schema:
          type: integer
          default: 1
          minimum: 1
        description: Page number
      - name: limit
        in: query
        schema:
          type: integer
          default: 20
          minimum: 1
          maximum: 100
        description: Items per page
    responses:
      '200':
        description: List of tasks
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  type: array
                  items:
                    $ref: '../schemas/task.yaml#/Task'
                pagination:
                  $ref: '../schemas/common.yaml#/Pagination'
              required:
                - success
                - data
      '404':
        description: Project not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

  post:
    summary: Create task
    description: Create a new task in a project
    operationId: createTask
    tags:
      - Tasks
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Project ID
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/task.yaml#/CreateTaskRequest'
    responses:
      '201':
        description: Task created
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  $ref: '../schemas/task.yaml#/Task'
              required:
                - success
                - data
      '400':
        description: Invalid request body
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'
      '404':
        description: Project not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

tasks-id:
  get:
    summary: Get task
    description: Get task details by ID
    operationId: getTask
    tags:
      - Tasks
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Task ID
    responses:
      '200':
        description: Task details
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  $ref: '../schemas/task.yaml#/Task'
              required:
                - success
                - data
      '404':
        description: Task not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

  patch:
    summary: Update task
    description: Partially update task details
    operationId: updateTask
    tags:
      - Tasks
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Task ID
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/task.yaml#/UpdateTaskRequest'
    responses:
      '200':
        description: Updated task
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  $ref: '../schemas/task.yaml#/Task'
              required:
                - success
                - data
      '400':
        description: Invalid request body
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'
      '404':
        description: Task not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'
      '409':
        description: Invalid state transition
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

  delete:
    summary: Delete task
    description: Delete a task
    operationId: deleteTask
    tags:
      - Tasks
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Task ID
    responses:
      '204':
        description: Task deleted
      '404':
        description: Task not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'
      '409':
        description: Cannot delete task in current state
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

tasks-id-assignee:
  put:
    summary: Assign task
    description: Assign or unassign a task to a user
    operationId: assignTask
    tags:
      - Tasks
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Task ID
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              user_id:
                type: integer
                nullable: true
                description: User ID to assign, or null to unassign
    responses:
      '200':
        description: Task assignment updated
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  $ref: '../schemas/task.yaml#/Task'
              required:
                - success
                - data
      '404':
        description: Task or user not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

tasks-id-dependencies:
  get:
    summary: List task dependencies
    description: Get all dependencies for a task
    operationId: listTaskDependencies
    tags:
      - Tasks
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Task ID
    responses:
      '200':
        description: Task dependencies
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  type: array
                  items:
                    $ref: '../schemas/task.yaml#/TaskDependency'
              required:
                - success
                - data
      '404':
        description: Task not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

  post:
    summary: Add dependency
    description: Add a dependency to a task
    operationId: addTaskDependency
    tags:
      - Tasks
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Task ID
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              depends_on_task_id:
                type: integer
                description: ID of the task this task depends on
            required:
              - depends_on_task_id
    responses:
      '201':
        description: Dependency added
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  $ref: '../schemas/task.yaml#/TaskDependency'
              required:
                - success
                - data
      '400':
        description: Invalid dependency (e.g., circular dependency)
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'
      '404':
        description: Task not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'
      '409':
        description: Dependency already exists
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

tasks-id-dependencies-dep-id:
  delete:
    summary: Remove dependency
    description: Remove a dependency from a task
    operationId: removeTaskDependency
    tags:
      - Tasks
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Task ID
      - name: dep_id
        in: path
        required: true
        schema:
          type: integer
        description: Dependency task ID to remove
    responses:
      '204':
        description: Dependency removed
      '404':
        description: Task or dependency not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

tasks-id-agent:
  get:
    summary: Get agent status
    description: Get the current agent status for a task
    operationId: getTaskAgentStatus
    tags:
      - Tasks
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Task ID
    responses:
      '200':
        description: Agent status
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  $ref: '../schemas/task.yaml#/AgentStatus'
              required:
                - success
                - data
      '404':
        description: Task not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

  put:
    summary: Control agent
    description: Start, pause, resume, or stop the agent for a task
    operationId: controlTaskAgent
    tags:
      - Tasks
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Task ID
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              action:
                type: string
                enum: [start, pause, resume, stop]
                description: Agent control action
            required:
              - action
    responses:
      '200':
        description: Agent action executed
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  $ref: '../schemas/task.yaml#/AgentStatus'
              required:
                - success
                - data
      '400':
        description: Invalid action for current agent state
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'
      '404':
        description: Task not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'
      '409':
        description: Agent is not in a valid state for this action
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

tasks-id-agent-output:
  get:
    summary: Get agent output
    description: Get terminal output from the running agent
    operationId: getTaskAgentOutput
    tags:
      - Tasks
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Task ID
      - name: since
        in: query
        schema:
          type: integer
          minimum: 0
        description: Return output after this byte offset
    responses:
      '200':
        description: Agent terminal output
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  $ref: '../schemas/task.yaml#/TerminalOutput'
              required:
                - success
                - data
      '404':
        description: Task not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

tasks-id-changes:
  get:
    summary: Get task changes
    description: Get list of files changed by a task
    operationId: getTaskChanges
    tags:
      - Tasks
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Task ID
    responses:
      '200':
        description: Files changed by the task
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  type: array
                  items:
                    $ref: '../schemas/task.yaml#/FileChange'
              required:
                - success
                - data
      '404':
        description: Task not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

tasks-id-diff:
  get:
    summary: Get task diff
    description: Get unified diff of all changes made by a task
    operationId: getTaskDiff
    tags:
      - Tasks
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Task ID
    responses:
      '200':
        description: Code diff
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  $ref: '../schemas/task.yaml#/TaskDiff'
              required:
                - success
                - data
      '404':
        description: Task not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

tasks-id-review:
  post:
    summary: Submit task review
    description: Approve or request changes for a task pending review
    operationId: submitTaskReview
    tags:
      - Tasks
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Task ID
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/task.yaml#/ReviewRequest'
    responses:
      '200':
        description: Review submitted
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  $ref: '../schemas/task.yaml#/Task'
              required:
                - success
                - data
      '400':
        description: Invalid review request
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'
      '404':
        description: Task not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'
      '409':
        description: Task is not pending review
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

tasks-id-create-pr:
  post:
    summary: Create PR for task
    description: Commit changes and create a pull request for a task pending review
    operationId: createTaskPR
    tags:
      - Tasks
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Task ID
    responses:
      '200':
        description: PR created
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  $ref: '../schemas/task.yaml#/ApproveAndPRResult'
              required:
                - success
                - data
      '400':
        description: Task not in pending_review status or no changes
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'
      '404':
        description: Task not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

tasks-id-approve:
  post:
    summary: Approve task
    description: Approve a task and mark it as done
    operationId: approveTask
    tags:
      - Tasks
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Task ID
    responses:
      '200':
        description: Task approved
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  $ref: '../schemas/task.yaml#/Task'
              required:
                - success
                - data
      '400':
        description: Task not in pending_review status
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'
      '404':
        description: Task not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

tasks-id-file-changes:
  get:
    summary: Get file changes for task
    description: Get tracked file changes recorded during agent execution for a task
    operationId: getTaskFileChanges
    tags:
      - Tasks
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Task ID
    responses:
      '200':
        description: Task file changes
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  $ref: '../schemas/task.yaml#/TaskFileChangesResponse'
              required:
                - success
                - data
      '404':
        description: Task not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'
