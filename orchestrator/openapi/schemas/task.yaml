Task:
  type: object
  properties:
    id:
      type: integer
    project_id:
      type: integer
    epic_id:
      type: integer
      nullable: true
    title:
      type: string
    description:
      type: string
      nullable: true
    status:
      type: string
      enum: [backlog, ready, in_progress, pending_review, approved, done]
    requires_approval:
      type: boolean
    repo_name:
      type: string
      nullable: true
    agent_status:
      type: string
      enum: [idle, running, paused, stopped, completed, failed]
      nullable: true
    progress_percentage:
      type: integer
      minimum: 0
      maximum: 100
    blocked_by_count:
      type: integer
      minimum: 0
      description: Number of incomplete tasks blocking this task
    estimated_duration:
      type: integer
      nullable: true
      description: Estimated duration in minutes
    actual_duration:
      type: integer
      nullable: true
      description: Actual duration in minutes
    github_issue_number:
      type: integer
      nullable: true
    github_branch_name:
      type: string
      nullable: true
    github_pr_number:
      type: integer
      nullable: true
    github_pr_url:
      type: string
      nullable: true
    created_by_user_id:
      type: integer
    assigned_to_user_id:
      type: integer
      nullable: true
    acceptance_criteria:
      type: string
      nullable: true
      description: Testable acceptance criteria (markdown checklist)
    scope_in:
      type: string
      nullable: true
      description: What is explicitly in scope for this task
    scope_out:
      type: string
      nullable: true
      description: What is explicitly out of scope
    owner_user_id:
      type: integer
      nullable: true
      description: User ID of the human owner accountable for quality
    executor_type:
      type: string
      enum: [human, agent]
      description: Whether executor is a human developer or AI agent
    assigned_agent_id:
      type: integer
      nullable: true
      description: ID of the agent assigned to execute this task
    created_at:
      type: string
      format: date-time
    updated_at:
      type: string
      format: date-time
  required:
    - id
    - project_id
    - title
    - status
    - requires_approval
    - progress_percentage
    - created_by_user_id
    - created_at
    - updated_at

CreateTaskRequest:
  type: object
  properties:
    title:
      type: string
      minLength: 1
      maxLength: 200
    description:
      type: string
      nullable: true
    epic_id:
      type: integer
      nullable: true
    requires_approval:
      type: boolean
      default: true
    repo_name:
      type: string
      nullable: true
    estimated_duration:
      type: integer
      nullable: true
      description: Estimated duration in minutes
    dependencies:
      type: array
      items:
        type: integer
      description: Array of task IDs this task depends on
    acceptance_criteria:
      type: array
      items:
        type: string
        minLength: 1
      minItems: 1
      description: List of acceptance criteria - at least one required to define what "done" means
    scope_in:
      type: string
      nullable: true
      description: What is explicitly in scope for this task
    scope_out:
      type: string
      nullable: true
      description: What is explicitly out of scope
    owner_user_id:
      type: integer
      nullable: true
      description: User ID of the human owner accountable for quality
    executor_type:
      type: string
      enum: [human, agent]
      description: Whether executor is a human developer or AI agent
    assigned_agent_id:
      type: integer
      nullable: true
      description: ID of the agent assigned to execute this task
  required:
    - title
    - acceptance_criteria

UpdateTaskRequest:
  type: object
  properties:
    title:
      type: string
      minLength: 1
      maxLength: 200
    description:
      type: string
      nullable: true
    epic_id:
      type: integer
      nullable: true
    status:
      type: string
      enum: [backlog, ready, in_progress, pending_review, approved, done]
    requires_approval:
      type: boolean
    repo_name:
      type: string
      nullable: true
    estimated_duration:
      type: integer
      nullable: true
    acceptance_criteria:
      type: string
      nullable: true
      description: Testable acceptance criteria (markdown checklist)
    scope_in:
      type: string
      nullable: true
      description: What is explicitly in scope for this task
    scope_out:
      type: string
      nullable: true
      description: What is explicitly out of scope
    owner_user_id:
      type: integer
      nullable: true
      description: User ID of the human owner accountable for quality
    executor_type:
      type: string
      enum: [human, agent]
      description: Whether executor is a human developer or AI agent
    assigned_agent_id:
      type: integer
      nullable: true
      description: ID of the agent assigned to execute this task

TaskDependency:
  type: object
  properties:
    id:
      type: integer
    task_id:
      type: integer
    depends_on_task_id:
      type: integer
    depends_on_task:
      $ref: '#/Task'
  required:
    - id
    - task_id
    - depends_on_task_id

AgentStatus:
  type: object
  properties:
    task_id:
      type: integer
    status:
      type: string
      enum: [idle, running, paused, stopped, completed, failed]
    pid:
      type: integer
      nullable: true
      description: Process ID of the running agent
    started_at:
      type: string
      format: date-time
      nullable: true
    stopped_at:
      type: string
      format: date-time
      nullable: true
    error_message:
      type: string
      nullable: true
  required:
    - task_id
    - status

TerminalOutput:
  type: object
  properties:
    task_id:
      type: integer
    output:
      type: string
    offset:
      type: integer
      description: Byte offset for pagination
    has_more:
      type: boolean
      description: Whether there is more output available
  required:
    - task_id
    - output
    - offset
    - has_more

FileChange:
  type: object
  properties:
    path:
      type: string
    status:
      type: string
      enum: [added, modified, deleted, renamed]
    old_path:
      type: string
      nullable: true
      description: Original path for renamed files
    lines_added:
      type: integer
    lines_removed:
      type: integer
  required:
    - path
    - status
    - lines_added
    - lines_removed

TaskDiff:
  type: object
  properties:
    hasChanges:
      type: boolean
      description: Whether the task worktree has uncommitted changes
    filesChanged:
      type: array
      items:
        type: string
      description: List of changed file paths
    insertions:
      type: integer
      description: Number of lines added
    deletions:
      type: integer
      description: Number of lines removed
    diff:
      type: string
      description: Unified diff of all changes
  required:
    - hasChanges
    - filesChanged
    - diff

ApproveAndPRResult:
  type: object
  properties:
    taskId:
      type: integer
    exitCode:
      type: integer
    hasChanges:
      type: boolean
    requiresApproval:
      type: boolean
    taskStatus:
      type: string
    prCreated:
      type: boolean
    prUrl:
      type: string
      nullable: true
    prNumber:
      type: integer
      nullable: true
    commitHash:
      type: string
      nullable: true
    worktreeCleaned:
      type: boolean
  required:
    - taskId
    - hasChanges
    - taskStatus
    - prCreated
    - worktreeCleaned

ReviewRequest:
  type: object
  properties:
    decision:
      type: string
      enum: [approve, request_changes]
    feedback:
      type: string
      nullable: true
      description: Required when decision is request_changes
  required:
    - decision

TrackedFileChange:
  type: object
  description: A file change tracked during agent execution
  properties:
    id:
      type: integer
    taskId:
      type: integer
    sessionId:
      type: integer
      nullable: true
    filePath:
      type: string
      description: Path of the changed file relative to repository root
    changeType:
      type: string
      enum: [created, modified, deleted]
    diffSummary:
      type: string
      nullable: true
      description: Summary of the changes made to this file
    createdAt:
      type: string
      format: date-time
  required:
    - id
    - taskId
    - filePath
    - changeType
    - createdAt

FileChangeSummary:
  type: object
  description: Summary of file changes for a task
  properties:
    total:
      type: integer
    created:
      type: integer
    modified:
      type: integer
    deleted:
      type: integer
  required:
    - total
    - created
    - modified
    - deleted

TaskFileChangesResponse:
  type: object
  properties:
    changes:
      type: array
      items:
        $ref: '#/TrackedFileChange'
    summary:
      $ref: '#/FileChangeSummary'
  required:
    - changes
    - summary

AcceptanceCriterion:
  type: object
  description: An acceptance criterion for a task or epic
  properties:
    id:
      type: integer
    entity_type:
      type: string
      enum: [epic, task]
      description: Type of entity this criterion belongs to
    entity_id:
      type: integer
      description: ID of the parent entity (epic or task)
    text:
      type: string
      description: The criterion text
    checked:
      type: boolean
      description: Whether this criterion has been satisfied
    checked_at:
      type: string
      format: date-time
      nullable: true
      description: When the criterion was checked/satisfied
    position:
      type: integer
      description: Display order position (0-indexed)
    created_at:
      type: string
      format: date-time
  required:
    - id
    - entity_type
    - entity_id
    - text
    - checked
    - position
    - created_at

CreateCriterionRequest:
  type: object
  properties:
    text:
      type: string
      minLength: 1
      description: The criterion text
    position:
      type: integer
      description: Optional display order position
  required:
    - text

UpdateCriterionRequest:
  type: object
  properties:
    text:
      type: string
      minLength: 1
      description: Updated criterion text
    checked:
      type: boolean
      description: Whether the criterion is satisfied
    position:
      type: integer
      description: Display order position

TaskStateInfo:
  type: object
  description: Task state file information
  properties:
    exists:
      type: boolean
      description: Whether the task state file exists
    file_path:
      type: string
      nullable: true
      description: Absolute path to the state file
    state:
      type: object
      nullable: true
      description: Parsed state metadata if file exists
      properties:
        metadata:
          type: object
          properties:
            task_id:
              type: integer
            title:
              type: string
            status:
              type: string
            start_time:
              type: string
        session_count:
          type: integer
        has_chain_output:
          type: boolean
        has_chain_inputs:
          type: boolean
        has_archived_sessions:
          type: boolean
  required:
    - exists
