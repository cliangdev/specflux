Task:
  type: object
  properties:
    id:
      type: integer
    project_id:
      type: integer
    epic_id:
      type: integer
      nullable: true
    title:
      type: string
    description:
      type: string
      nullable: true
    status:
      type: string
      enum: [backlog, ready, in_progress, pending_review, approved, done]
    requires_approval:
      type: boolean
    repo_name:
      type: string
      nullable: true
    agent_status:
      type: string
      enum: [idle, running, paused, stopped, completed, failed]
      nullable: true
    progress_percentage:
      type: integer
      minimum: 0
      maximum: 100
    estimated_duration:
      type: integer
      nullable: true
      description: Estimated duration in minutes
    actual_duration:
      type: integer
      nullable: true
      description: Actual duration in minutes
    github_issue_number:
      type: integer
      nullable: true
    github_branch_name:
      type: string
      nullable: true
    github_pr_number:
      type: integer
      nullable: true
    created_by_user_id:
      type: integer
    assigned_to_user_id:
      type: integer
      nullable: true
    created_at:
      type: string
      format: date-time
    updated_at:
      type: string
      format: date-time
  required:
    - id
    - project_id
    - title
    - status
    - requires_approval
    - progress_percentage
    - created_by_user_id
    - created_at
    - updated_at

CreateTaskRequest:
  type: object
  properties:
    title:
      type: string
      minLength: 1
      maxLength: 200
    description:
      type: string
      nullable: true
    epic_id:
      type: integer
      nullable: true
    requires_approval:
      type: boolean
      default: true
    repo_name:
      type: string
      nullable: true
    estimated_duration:
      type: integer
      nullable: true
      description: Estimated duration in minutes
    dependencies:
      type: array
      items:
        type: integer
      description: Array of task IDs this task depends on
  required:
    - title

UpdateTaskRequest:
  type: object
  properties:
    title:
      type: string
      minLength: 1
      maxLength: 200
    description:
      type: string
      nullable: true
    status:
      type: string
      enum: [backlog, ready, in_progress, pending_review, approved, done]
    requires_approval:
      type: boolean
    repo_name:
      type: string
      nullable: true
    estimated_duration:
      type: integer
      nullable: true

TaskDependency:
  type: object
  properties:
    id:
      type: integer
    task_id:
      type: integer
    depends_on_task_id:
      type: integer
    depends_on_task:
      $ref: '#/Task'
  required:
    - id
    - task_id
    - depends_on_task_id

AgentStatus:
  type: object
  properties:
    task_id:
      type: integer
    status:
      type: string
      enum: [idle, running, paused, stopped, completed, failed]
    pid:
      type: integer
      nullable: true
      description: Process ID of the running agent
    started_at:
      type: string
      format: date-time
      nullable: true
    stopped_at:
      type: string
      format: date-time
      nullable: true
    error_message:
      type: string
      nullable: true
  required:
    - task_id
    - status

TerminalOutput:
  type: object
  properties:
    task_id:
      type: integer
    output:
      type: string
    offset:
      type: integer
      description: Byte offset for pagination
    has_more:
      type: boolean
      description: Whether there is more output available
  required:
    - task_id
    - output
    - offset
    - has_more

FileChange:
  type: object
  properties:
    path:
      type: string
    status:
      type: string
      enum: [added, modified, deleted, renamed]
    old_path:
      type: string
      nullable: true
      description: Original path for renamed files
    lines_added:
      type: integer
    lines_removed:
      type: integer
  required:
    - path
    - status
    - lines_added
    - lines_removed

TaskDiff:
  type: object
  properties:
    hasChanges:
      type: boolean
      description: Whether the task worktree has uncommitted changes
    filesChanged:
      type: array
      items:
        type: string
      description: List of changed file paths
    insertions:
      type: integer
      description: Number of lines added
    deletions:
      type: integer
      description: Number of lines removed
    diff:
      type: string
      description: Unified diff of all changes
  required:
    - hasChanges
    - filesChanged
    - diff

ApproveAndPRResult:
  type: object
  properties:
    taskId:
      type: integer
    exitCode:
      type: integer
    hasChanges:
      type: boolean
    requiresApproval:
      type: boolean
    taskStatus:
      type: string
    prCreated:
      type: boolean
    prUrl:
      type: string
      nullable: true
    prNumber:
      type: integer
      nullable: true
    commitHash:
      type: string
      nullable: true
    worktreeCleaned:
      type: boolean
  required:
    - taskId
    - hasChanges
    - taskStatus
    - prCreated
    - worktreeCleaned

ReviewRequest:
  type: object
  properties:
    decision:
      type: string
      enum: [approve, request_changes]
    feedback:
      type: string
      nullable: true
      description: Required when decision is request_changes
  required:
    - decision
